<!DOCTYPE html>
<!--
  Egnyte Yoda - extension UI shell
  Version: 1.8.0

  v1.8.2 - First-run setup screen for configurable API base URL
  v1.8.1 - Auto-update check against GitHub on startup
  v1.7.7 - Added Diffs Only toggle switch to Compare and Domain Versions toolbars
  v1.7.1 - Removed dead Plans standalone CSS (~400 lines); added Plans/Add-ons filter pills
  v1.7.0 - Plans & Add-ons pills added to compare toolbar
  v1.6.0 - Initial IBM Plex styled dark UI with tabs, sidebar, table
-->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Egnyte Yoda</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2235;
    --border: #1e2d45;
    --accent: #00c2ff;
    --accent2: #ff6b35;
    --success: #22c55e;
    --warn: #fbbf24;
    --danger: #ef4444;
    --text: #e2e8f0;
    --muted: #64748b;
    --diff-add: rgba(34,197,94,0.12);
    --diff-remove: rgba(239,68,68,0.12);
    --diff-border-add: rgba(34,197,94,0.4);
    --diff-border-remove: rgba(239,68,68,0.4);
  }

  /* ── LIGHT THEME ── */
  [data-theme="light"] {
    --bg: #f0f4f8;
    --surface: #ffffff;
    --surface2: #e8edf3;
    --border: #c8d3e0;
    --accent: #0077b6;
    --accent2: #e05a1e;
    --success: #16a34a;
    --warn: #d97706;
    --danger: #dc2626;
    --text: #1a2235;
    --muted: #64748b;
    --diff-add: rgba(22,163,74,0.10);
    --diff-remove: rgba(220,38,38,0.10);
    --diff-border-add: rgba(22,163,74,0.4);
    --diff-border-remove: rgba(220,38,38,0.4);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'IBM Plex Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    width: 780px;
    min-height: 580px;
    overflow-x: hidden;
  }

  body.tab-mode {
    width: 100vw;
    min-height: 100vh;
  }

  body.tab-mode .main {
    height: calc(100vh - 57px);
  }

  /* ── HEADER ── */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo-icon {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .logo-icon img {
    width: 28px;
    height: 28px;
    object-fit: contain;
  }

  .logo-text {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    color: var(--accent);
  }

  .logo-sub {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-left: 4px;
  }

  .header-actions {
    display: flex;
    gap: 8px;
    align-items: center;
  }



  /* ── TABS ── */
  .tabs {
    display: flex;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    padding: 0 20px;
    gap: 4px;
    flex-shrink: 0;
  }

  .tab {
    padding: 9px 16px;
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    cursor: pointer;
    color: var(--muted);
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
    background: none;
    border-top: none;
    border-left: none;
    border-right: none;
  }

  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .tab:hover:not(.active) { color: var(--text); }

  /* ── MAIN LAYOUT ── */
  .main { display: flex; height: calc(100vh - 100px); min-height: 500px; }

  /* ── SIDEBAR ── */
  .sidebar {
    width: 200px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
  }

  .sidebar-header {
    padding: 12px 14px;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .domain-input-row {
    display: flex;
    padding: 10px 12px;
    gap: 6px;
    border-bottom: 1px solid var(--border);
  }

  .domain-input {
    flex: 1;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 6px 8px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--text);
    outline: none;
  }

  .domain-input:focus { border-color: var(--accent); }
  .domain-input::placeholder { color: var(--muted); }

  .btn {
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
    letter-spacing: 0.04em;
  }

  .btn-primary {
    background: var(--accent);
    color: #000;
  }

  .btn-primary:hover { background: #33ccff; }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; }

  .btn-ghost {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
  }

  .btn-ghost:hover { border-color: var(--accent); color: var(--accent); }

  .btn-accent {
    background: rgba(0,194,255,0.1);
    border: 1px solid var(--accent);
    color: var(--accent);
  }

  .btn-accent:hover { background: rgba(0,194,255,0.2); }

  .btn-icon {
    padding: 6px 9px;
    font-size: 14px;
    line-height: 1;
  }

  /* Hide open-tab button when already in tab mode */
  body.tab-mode #open-tab-btn { display: none; }

  /* Domain List */
  .domain-list { flex: 1; overflow-y: auto; }

  .domain-item {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    gap: 8px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: background 0.15s;
  }

  .domain-item:hover { background: var(--surface2); }
  .domain-item.selected { background: rgba(0,194,255,0.08); }

  .domain-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .domain-name {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .domain-status-badge {
    font-size: 9px;
    font-weight: 600;
    padding: 2px 5px;
    border-radius: 3px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .status-active { background: rgba(34,197,94,0.15); color: var(--success); }
  .status-loading { background: rgba(0,194,255,0.15); color: var(--accent); }
  .status-error { background: rgba(239,68,68,0.15); color: var(--danger); }

  .version-new-badge {
    font-size: 9px;
    font-weight: 700;
    padding: 2px 5px;
    border-radius: 3px;
    background: rgba(168,85,247,0.2);
    color: #a855f7;
    border: 1px solid rgba(168,85,247,0.4);
    letter-spacing: 0.04em;
    white-space: nowrap;
  }

  .domain-flash {
    padding: 6px 12px;
    font-size: 11px;
    font-weight: 500;
    color: var(--danger);
    background: rgba(239,68,68,0.1);
    border: 1px solid rgba(239,68,68,0.3);
    border-radius: 4px;
    margin: 0 12px 6px;
    display: none;
    animation: flashIn 0.15s ease;
  }

  @keyframes flashIn {
    from { opacity: 0; transform: translateY(-4px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .domain-flash.visible { display: block; }

  .domain-flash.flash-warn {
    color: var(--warn);
    background: rgba(251,191,36,0.1);
    border-color: rgba(251,191,36,0.35);
  }

  .domain-remove {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 14px;
    line-height: 1;
    padding: 0 2px;
    opacity: 0;
    transition: opacity 0.15s;
  }

  .domain-item:hover .domain-remove { opacity: 1; }
  .domain-remove:hover { color: var(--danger); }

  /* sidebar compare btn */
  .sidebar-footer {
    padding: 10px 12px;
    border-top: 1px solid var(--border);
  }

  /* ── CONTENT ── */
  .content {
    flex: 1;
    overflow: auto;
    display: flex;
    flex-direction: column;
  }

  /* ── COMPARE VIEW ── */
  .compare-toolbar {
    display: flex;
    align-items: center;
    padding: 10px 16px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    gap: 12px;
    flex-shrink: 0;
  }

  .toolbar-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .filter-pills {
    display: flex;
    gap: 4px;
    flex: 1;
  }

  .pill {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    transition: all 0.15s;
  }

  .pill.active {
    background: rgba(0,194,255,0.12);
    border-color: var(--accent);
    color: var(--accent);
  }

  .pill:hover:not(.active) { color: var(--text); border-color: var(--muted); }

  .diff-count {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--warn);
    background: rgba(251,191,36,0.1);
    padding: 3px 8px;
    border-radius: 4px;
  }

  .field-search-wrap {
    position: relative;
    display: flex;
    align-items: center;
  }

  .field-search-icon {
    position: absolute;
    left: 8px;
    font-size: 11px;
    color: var(--muted);
    pointer-events: none;
  }

  .field-search {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 5px 28px 5px 26px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--text);
    outline: none;
    width: 180px;
    transition: border-color 0.15s, width 0.2s;
  }

  .field-search:focus {
    border-color: var(--accent);
    width: 220px;
  }

  .field-search::placeholder { color: var(--muted); }

  .field-search-clear {
    position: absolute;
    right: 7px;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 13px;
    line-height: 1;
    padding: 0;
    display: none;
  }

  .field-search-clear:hover { color: var(--text); }

  .field-search-clear.visible { display: block; }

  /* Field key — hover tooltip (default) and always-visible (show-keys mode) */
  .compare-table td:first-child {
    position: relative;
  }

  .field-label-text {
    transition: opacity 0.15s;
  }

  /* ── Hover tooltip mode (default) ── */
  .compare-table td:first-child .field-key-tip {
    display: none;
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--surface2);
    border: 1px solid var(--accent);
    color: var(--accent);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 4px;
    white-space: nowrap;
    z-index: 20;
    pointer-events: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }

  .compare-table tr:hover td:first-child .field-key-tip {
    display: block;
  }

  .compare-table tr:hover td:first-child .field-label-text {
    opacity: 0.4;
  }

  /* ── Always-visible mode (show-keys class on table) ── */
  .compare-table.show-keys td:first-child .field-key-tip {
    display: block;
    position: static;
    transform: none;
    background: none;
    border: none;
    box-shadow: none;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    padding: 1px 0 0 0;
    border-radius: 0;
    white-space: nowrap;
    opacity: 0.7;
  }

  .compare-table.show-keys tr:hover td:first-child .field-key-tip {
    color: var(--accent);
    opacity: 1;
  }

  .compare-table.show-keys tr:hover td:first-child .field-label-text {
    opacity: 1;
  }

  .compare-table.show-keys td:first-child {
    white-space: normal;
  }

  /* ── Query tab ── */
  .query-toolbar {
    flex-wrap: wrap;
    gap: 6px 8px;
    align-items: center;
  }

  .query-op {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--fg);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    padding: 3px 6px;
    border-radius: 4px;
    cursor: pointer;
  }

  .query-op:focus { outline: 1px solid var(--accent); }

  .query-input {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--fg);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 4px;
    width: 180px;
  }

  .query-input:focus { outline: 1px solid var(--accent); border-color: var(--accent); }

  .query-val-input { width: 130px; }

  .query-and-sep {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: 0.08em;
    padding: 0 2px;
  }

  .query-empty-msg {
    color: var(--muted);
    font-size: 12px;
    padding: 24px 16px;
    text-align: center;
  }

  /* Hide value input when op is "any", "true", or "false" */
  .query-val-input.hidden { display: none; }

  /* ── Settings nested sub-section headers ── */
  .settings-level-header {
    padding-left: 12px;
    background: rgba(255,255,255,0.02);
    border-left: 2px solid var(--accent);
  }

  .settings-level-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent);
    opacity: 0.85;
  }

  .settings-prefix-header {
    padding-left: 28px;
    background: transparent;
    border-left: none;
  }

  .settings-prefix-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    font-weight: 500;
    color: var(--muted);
    letter-spacing: 0.04em;
  }

  .settings-prefix-row .section-chevron {
    font-size: 8px;
    opacity: 0.6;
  }

  .settings-field-cell {
    padding-left: 44px !important;
  }

  .query-val-match {
    outline: 1px solid rgba(0,194,255,0.4);
    background: rgba(0,194,255,0.08);
  }

  .search-highlight {
    background: rgba(0,194,255,0.25);
    border-radius: 2px;
    color: var(--accent);
  }

  /* Table */
  .compare-table-wrap {
    flex: 1;
    overflow: auto;
  }

  .compare-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }

  .compare-table thead {
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .compare-table th {
    background: var(--surface2);
    padding: 10px 14px;
    text-align: left;
    font-weight: 500;
    font-size: 11px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--muted);
    border-bottom: 2px solid var(--border);
    white-space: nowrap;
  }

  .compare-table th.domain-col {
    font-family: 'IBM Plex Mono', monospace;
    color: var(--text);
    font-size: 12px;
    text-transform: none;
    letter-spacing: 0;
  }

  .compare-table th.domain-col .col-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 6px;
  }

  .compare-table th:first-child {
    position: sticky;
    left: 0;
    z-index: 11;
    width: 200px;
    min-width: 200px;
  }

  .compare-table td {
    padding: 8px 14px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }

  .compare-table td:first-child {
    position: sticky;
    left: 0;
    background: var(--bg);
    z-index: 5;
    font-size: 11px;
    color: var(--muted);
    white-space: nowrap;
  }

  .compare-table tr:hover td { background: var(--surface2); }
  .compare-table tr:hover td:first-child { background: var(--surface2); }

  .compare-table td.val {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    white-space: nowrap;
  }

  .compare-table td.diff-cell {
    background: var(--diff-remove);
    border-left: 2px solid var(--diff-border-remove);
  }

  .compare-table td.same-cell { }

  .val-true { color: var(--success); }
  .val-false { color: var(--danger); }
  .val-num { color: var(--accent); }
  .val-str { color: var(--text); }

  .section-row td {
    background: var(--surface2) !important;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--accent);
    padding: 0;
    border-top: 2px solid var(--border);
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    user-select: none;
  }

  .section-row td:hover { background: #1e2d45 !important; }

  .section-header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 14px;
  }

  .section-header-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .section-chevron {
    font-size: 10px;
    transition: transform 0.2s ease;
    color: var(--muted);
    display: inline-block;
  }

  .section-chevron.collapsed { transform: rotate(-90deg); }

  .section-diff-badge {
    font-size: 9px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    background: rgba(251,191,36,0.15);
    color: var(--warn);
    border: 1px solid rgba(251,191,36,0.3);
    letter-spacing: 0.04em;
  }

  .section-count {
    font-size: 9px;
    color: var(--muted);
    font-weight: 400;
    letter-spacing: 0.04em;
    text-transform: none;
  }

  .data-row.section-collapsed { display: none; }

  /* Empty state */
  .empty-state {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    color: var(--muted);
    padding: 40px;
  }

  .empty-icon {
    font-size: 48px;
    opacity: 0.3;
  }

  .empty-title {
    font-size: 16px;
    font-weight: 500;
    color: var(--text);
    opacity: 0.5;
  }

  .empty-sub {
    font-size: 12px;
    text-align: center;
    max-width: 280px;
    line-height: 1.6;
  }

  /* loading spinner */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    width: 12px;
    height: 12px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    display: inline-block;
  }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--muted); }

  /* category filter */
  .category-select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 11px;
    color: var(--text);
    outline: none;
    cursor: pointer;
  }

  .category-select:focus { border-color: var(--accent); }

  /* Bulk import modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    display: none;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px;
    width: 380px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .modal-title {
    font-size: 14px;
    font-weight: 600;
  }

  .modal textarea {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 10px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    color: var(--text);
    resize: vertical;
    min-height: 120px;
    width: 100%;
    outline: none;
  }

  .modal textarea:focus { border-color: var(--accent); }

  .modal-actions { display: flex; gap: 8px; justify-content: flex-end; }


  /* ── DIFF TOGGLE ── */
  .diff-toggle-wrap {
    display: flex;
    align-items: center;
    gap: 7px;
    flex-shrink: 0;
  }

  .diff-toggle-label {
    font-size: 11px;
    font-weight: 500;
    color: var(--muted);
    letter-spacing: 0.04em;
    white-space: nowrap;
    transition: color 0.15s;
    user-select: none;
    cursor: pointer;
  }

  .diff-toggle-wrap.active .diff-toggle-label {
    color: var(--warn);
  }

  .toggle-switch {
    position: relative;
    width: 32px;
    height: 18px;
    flex-shrink: 0;
    cursor: pointer;
  }

  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
    position: absolute;
  }

  .toggle-track {
    position: absolute;
    inset: 0;
    border-radius: 18px;
    background: var(--surface2);
    border: 1px solid var(--border);
    transition: background 0.2s, border-color 0.2s;
  }

  .toggle-thumb {
    position: absolute;
    top: 3px;
    left: 3px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--muted);
    transition: transform 0.2s, background 0.2s;
  }

  .toggle-switch input:checked + .toggle-track {
    background: rgba(251,191,36,0.15);
    border-color: var(--warn);
  }

  .toggle-switch input:checked + .toggle-track + .toggle-thumb {
    transform: translateX(14px);
    background: var(--warn);
  }


  /* ── RELEASE NOTES MODAL ── */
  .relnotes-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    border-radius: 4px;
    padding: 5px 9px;
    font-size: 12px;
    cursor: pointer;
    line-height: 1;
    transition: all 0.15s;
  }
  .relnotes-btn:hover { border-color: var(--accent); color: var(--accent); }

  .relnotes-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.65);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 200;
  }
  .relnotes-overlay.open { display: flex; }

  .relnotes-modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    width: 420px;
    max-height: 480px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .relnotes-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 18px;
    border-bottom: 1px solid var(--border);
  }

  .relnotes-title {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    font-weight: 600;
    color: var(--accent);
  }

  .relnotes-close {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 18px;
    cursor: pointer;
    line-height: 1;
    padding: 0 2px;
    transition: color 0.15s;
  }
  .relnotes-close:hover { color: var(--text); }

  .relnotes-body {
    overflow-y: auto;
    padding: 16px 18px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .relnotes-entry {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .relnotes-version {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    color: var(--accent);
  }

  .relnotes-version.older { color: var(--muted); }

  .relnotes-items {
    display: flex;
    flex-direction: column;
    gap: 3px;
    padding-left: 10px;
  }

  .relnotes-item {
    font-size: 11px;
    color: var(--text);
    line-height: 1.5;
    display: flex;
    gap: 6px;
  }

  .relnotes-item::before {
    content: '›';
    color: var(--muted);
    flex-shrink: 0;
  }

  /* ── FIRST-RUN SETUP SCREEN ── */
  .setup-overlay {
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 500;
    display: none;
    align-items: center;
    justify-content: center;
  }
  .setup-overlay.open { display: flex; }

  .setup-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 32px 28px;
    width: 420px;
    display: flex;
    flex-direction: column;
    gap: 18px;
  }

  .setup-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 4px;
  }

  .setup-title {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 15px;
    font-weight: 600;
    color: var(--accent);
  }

  .setup-sub {
    font-size: 12px;
    color: var(--muted);
    line-height: 1.6;
  }

  .setup-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .setup-label {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .setup-input {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 9px 12px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: var(--text);
    outline: none;
    width: 100%;
    transition: border-color 0.15s;
  }
  .setup-input:focus { border-color: var(--accent); }
  .setup-input::placeholder { color: var(--muted); }
  .setup-input.error { border-color: var(--danger); }

  .setup-hint {
    font-size: 10px;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
  }

  .setup-error {
    font-size: 11px;
    color: var(--danger);
    display: none;
    align-items: center;
    gap: 5px;
  }
  .setup-error.visible { display: flex; }

  .setup-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    align-items: center;
    padding-top: 4px;
  }

  .setup-skip {
    font-size: 11px;
    color: var(--muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    text-decoration: underline;
  }
  .setup-skip:hover { color: var(--text); }

  /* ── UPDATE BANNER ── */
  .update-banner {
    display: none;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    background: rgba(0,194,255,0.08);
    border-bottom: 1px solid rgba(0,194,255,0.25);
    font-size: 11px;
    color: var(--text);
    flex-shrink: 0;
  }
  .update-banner.visible { display: flex; }
  .update-banner-icon { font-size: 14px; flex-shrink: 0; }
  .update-banner-text { flex: 1; line-height: 1.4; }
  .update-banner-text strong { color: var(--accent); }
  .update-banner-steps {
    margin-top: 3px;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
  }
  .update-banner-actions { display: flex; gap: 6px; align-items: center; flex-shrink: 0; }
  .update-dismiss {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 16px;
    cursor: pointer;
    line-height: 1;
    padding: 0 2px;
    flex-shrink: 0;
  }
  .update-dismiss:hover { color: var(--text); }

  /* Pulse the version badge when update is available */
  .relnotes-btn.update-available {
    border-color: var(--accent);
    color: var(--accent);
    animation: pulse 1.5s ease-in-out infinite;
  }

  /* ── THEME TOGGLE BUTTON ── */
  .theme-toggle-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    border-radius: 4px;
    padding: 5px 8px;
    font-size: 14px;
    cursor: pointer;
    line-height: 1;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .theme-toggle-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }
  .theme-toggle-btn .theme-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    font-family: 'IBM Plex Mono', monospace;
  }

  /* Light mode surface tweaks */
  [data-theme="light"] .compare-table td:first-child {
    background: var(--bg);
  }
  [data-theme="light"] .compare-table tr:hover td:first-child {
    background: var(--surface2);
  }
  [data-theme="light"] .section-row td {
    background: var(--surface2) !important;
  }
  [data-theme="light"] .section-row td:hover {
    background: var(--border) !important;
  }
  [data-theme="light"] .field-search,
  [data-theme="light"] .domain-input {
    background: var(--surface);
  }
  [data-theme="light"] .modal {
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
  }
  [data-theme="light"] .relnotes-modal {
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon"><img src="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAgACADASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAABwAEBQYI/8QAJBAAAgIBBAIDAQEBAAAAAAAAAQIDBAUABhEhEjEHQVFh8CP/xAAYAQACAwAAAAAAAAAAAAAAAAAAAQIFB//EACARAQABAwQDAQAAAAAAAAAAAAECAAMEESFBUTFC8bH/2gAMAwEAAhEDEQA/AObqwQ1a0davGsUMShERRwFA9DV3FUpsllKmOrlBNamSGMueF8mIA5P5ydTFPRjyVeTJwTWKSyAzxQv4O6/YB+j/ALrTo2yds7jjo7x+NHrpaoSxytj5GKo7IQQjc9xuePfo+/7q8uXS3s1kuFgTzFYop5PZOU7/AGgzL0ZsXlbeNslDNVmeGQoeV8lJB4P51qjaghtV5K9iJZYZFKujDkMD9a9ArsnbW3lv7z+S3rtavyySrjo2LIjOSSi8dyP379D3/dBmXehLk7MmLrzV6TSEwRTP5ui/QJ+/9796Ld0ubFGbgTw9JSQXwewcL1UxFCzlMnWx1QIbFmQRxh3CLyf0noaUvjinitvfKmBxeGz82QuMZo8o8HVVv+bEIh9vwR2T1zxxoeqWYLdaOzVmSaGRfJHQ8hhrY2vm7m3M9VzNBYms1iTGJVJXtSp5AI+idO5FnF0eKhhZEMa7FnHckavIDvod/KS/kunitwfKucxeZz02OtqIUxck3dVSY1LI59oCT7HXPJOivL4+zispZxtwRixWkMcng4deR+EdHVrdWcubkz1nNZBYVs2fHzESlV6UKOASfoDWPanhq15LFmVIoY1LO7ngKP0nRbgwiC8U83Ihk3ZShHdko8ou2p38r//Z" alt="Egnyte" /></div>
    <div>
      <div class="logo-text">EGNYTE YODA</div>
    </div>
  </div>
  <div class="header-actions">
    <button class="theme-toggle-btn" id="theme-toggle-btn" title="Toggle light/dark mode">
      <span id="theme-icon">☀️</span>
      <span class="theme-label" id="theme-label">Light</span>
    </button>
    <button class="theme-toggle-btn" id="reset-config-btn" title="Reset API base URL" style="display:none;">⚙ Config</button>
    <button class="relnotes-btn" id="relnotes-btn" title="Release notes">v1.8.2</button>
    <button class="btn btn-ghost" id="bulk-import-btn" title="Bulk import domains">⊕ Bulk Import</button>
    <button class="btn btn-ghost" id="export-btn" title="Export comparison">↓ Export</button>
    <button class="btn btn-accent btn-icon" id="open-tab-btn" title="Open in full tab">⤢</button>
  </div>
</header>



<div class="tabs">
  <button class="tab active" data-tab="compare">Compare</button>
  <button class="tab" data-tab="versions">Domain Versions</button>
  <button class="tab" data-tab="query">Query</button>
</div>

<!-- Update available banner -->
<div class="update-banner" id="update-banner">
  <span class="update-banner-icon">⬆</span>
  <div class="update-banner-text">
    <strong id="update-banner-version"></strong> is available.
    <div class="update-banner-steps">chrome://extensions → Egnyte Yoda → click ↻ Reload</div>
  </div>
  <div class="update-banner-actions">
    <a id="update-banner-notes" href="#" class="btn btn-accent" style="font-size:10px;padding:4px 8px;text-decoration:none;">What's new</a>
  </div>
  <button class="update-dismiss" id="update-dismiss" title="Dismiss">×</button>
</div>

<div class="main">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <span>Domains</span>
      <span id="domain-count" style="font-family: 'IBM Plex Mono', monospace; color: var(--accent);">0</span>
    </div>

    <div class="domain-input-row">
      <input class="domain-input" id="domain-input" type="text" placeholder="domain name..." />
      <button class="btn btn-primary" id="add-domain-btn">+</button>
    </div>
    <div class="domain-flash" id="domain-flash"></div>

    <div class="domain-list" id="domain-list"></div>

    <div class="sidebar-footer">
      <button class="btn btn-primary" id="compare-btn" style="width:100%;" disabled>Compare All</button>
    </div>
  </div>

  <!-- Content -->
  <div class="content" id="content">
    <div class="empty-state" id="empty-state">
      <div class="empty-icon">⬡</div>
      <div class="empty-title">No domains loaded</div>
      <div class="empty-sub">Add domain names in the sidebar and click Compare to fetch and compare their configurations.</div>
    </div>

    <div id="compare-view" style="display:none; flex-direction:column; flex:1; overflow:hidden;">
      <div class="compare-toolbar">
        <span class="toolbar-label">Filter:</span>
        <div class="filter-pills">
          <button class="pill active" data-filter="all">All</button>
          <button class="pill" data-filter="basic">Basic</button>
          <button class="pill" data-filter="features">Features</button>
          <button class="pill" data-filter="advanced">Advanced</button>
          <button class="pill" data-filter="plans">Plans</button>
          <button class="pill" data-filter="addons">Add-ons</button>
          <button class="pill" data-filter="settings">Settings</button>
        </div>
        <div class="diff-toggle-wrap" id="keys-toggle-wrap">
          <label class="diff-toggle-label" for="keys-toggle">Show keys</label>
          <label class="toggle-switch">
            <input type="checkbox" id="keys-toggle" />
            <div class="toggle-track"></div>
            <div class="toggle-thumb"></div>
          </label>
        </div>
        <div class="diff-toggle-wrap" id="diff-toggle-wrap">
          <label class="diff-toggle-label" for="diff-toggle">Diffs only</label>
          <label class="toggle-switch">
            <input type="checkbox" id="diff-toggle" />
            <div class="toggle-track"></div>
            <div class="toggle-thumb"></div>
          </label>
        </div>
        <div class="field-search-wrap">
          <span class="field-search-icon">⌕</span>
          <input class="field-search" id="field-search" type="text" placeholder="Search fields..." />
          <button class="field-search-clear" id="field-search-clear">×</button>
        </div>
        <div class="diff-count" id="diff-count" style="display:none;"></div>
      </div>
      <div class="compare-table-wrap">
        <table class="compare-table" id="compare-table">
          <thead id="compare-thead"></thead>
          <tbody id="compare-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ── VERSIONS VIEW ── -->
    <div id="versions-view" style="display:none; flex-direction:column; flex:1; overflow:hidden;">
      <div class="compare-toolbar" style="gap:16px;">
        <span class="toolbar-label">Domain:</span>
        <select class="category-select" id="versions-domain-select" style="min-width:160px;">
          <option value="">— select domain —</option>
        </select>
        <span class="toolbar-label" style="margin-left:8px;">Compare:</span>
        <select class="category-select" id="versions-v1-select" style="min-width:180px;"></select>
        <span style="color:var(--muted); font-size:12px;">vs</span>
        <select class="category-select" id="versions-v2-select" style="min-width:180px;"></select>
        <button class="btn btn-primary" id="versions-compare-btn" style="margin-left:4px;">Compare</button>
        <div class="diff-toggle-wrap" id="versions-diff-toggle-wrap">
          <label class="diff-toggle-label" for="versions-diff-toggle">Diffs only</label>
          <label class="toggle-switch">
            <input type="checkbox" id="versions-diff-toggle" />
            <div class="toggle-track"></div>
            <div class="toggle-thumb"></div>
          </label>
        </div>
        <div style="flex:1;"></div>
        <div class="diff-count" id="versions-diff-count" style="display:none;"></div>
      </div>
      <div class="compare-table-wrap">
        <div id="versions-empty" class="empty-state">
          <div class="empty-icon">⊚</div>
          <div class="empty-title">No versions yet</div>
          <div class="empty-sub">Load a domain in the Compare tab. Each time its config changes, a new version is saved automatically.</div>
        </div>
        <table class="compare-table" id="versions-table" style="display:none;">
          <thead id="versions-thead"></thead>
          <tbody id="versions-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ── QUERY VIEW ── -->
    <div id="query-view" style="display:none; flex-direction:column; flex:1; overflow:hidden;">
      <div class="compare-toolbar query-toolbar">
        <span class="toolbar-label">Key:</span>
        <select class="query-op" id="query-key-op">
          <option value="contains">contains</option>
          <option value="equals">equals</option>
        </select>
        <input class="query-input" id="query-key-val" type="text" placeholder="e.g. Indexer or afs.AfsRemote…" list="query-key-list" autocomplete="off" />
        <datalist id="query-key-list"></datalist>
        <span class="query-and-sep">AND</span>
        <span class="toolbar-label">Value:</span>
        <select class="query-op" id="query-val-op">
          <option value="any">any</option>
          <option value="contains">contains</option>
          <option value="equals">equals</option>
          <option value="true">is true</option>
          <option value="false">is false</option>
        </select>
        <input class="query-input query-val-input" id="query-val-val" type="text" placeholder="e.g. true or 86400" />
        <button class="btn btn-accent" id="query-run-btn">Run Query</button>
        <button class="btn btn-ghost" id="query-clear-btn">Clear</button>
        <div class="diff-count" id="query-result-count" style="display:none;"></div>
      </div>
      <div class="compare-table-wrap">
        <table class="compare-table show-keys" id="query-table">
          <thead id="query-thead"></thead>
          <tbody id="query-tbody">
            <tr><td colspan="99" class="query-empty-msg">Enter a key and/or value condition above and click Run Query.</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<!-- Bulk Import Modal -->
<div class="modal-overlay" id="bulk-modal">
  <div class="modal">
    <div class="modal-title">Bulk Import Domains</div>
    <div style="font-size:12px; color:var(--muted);">Paste domain names, one per line or comma-separated.</div>
    <textarea id="bulk-textarea" placeholder="anthroLogik&#10;temmNet&#10;example-domain"></textarea>
    <div class="modal-actions">
      <button class="btn btn-ghost" id="bulk-cancel">Cancel</button>
      <button class="btn btn-primary" id="bulk-import-confirm">Import</button>
    </div>
  </div>
</div>


<!-- Release Notes Modal -->
<div class="relnotes-overlay" id="relnotes-overlay">
  <div class="relnotes-modal">
    <div class="relnotes-header">
      <div class="relnotes-title">EGNYTE YODA — Release Notes</div>
      <button class="relnotes-close" id="relnotes-close">×</button>
    </div>
    <div class="relnotes-body" id="relnotes-body"></div>
  </div>
</div>

<!-- First-run setup overlay -->
<div class="setup-overlay" id="setup-overlay">
  <div class="setup-card">
    <div class="setup-logo">
      <div class="logo-icon"><img src="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/wAARCAAgACADASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAABwAEBQYI/8QAJBAAAgIBBAIDAQEBAAAAAAAAAQIDBAUABhEhEjEHQVFh8CP/xAAYAQACAwAAAAAAAAAAAAAAAAAAAQIFB//EACARAQABAwQDAQAAAAAAAAAAAAECAAMEESFBUTFC8bH/2gAMAwEAAhEDEQA/AObqwQ1a0davGsUMShERRwFA9DV3FUpsllKmOrlBNamSGMueF8mIA5P5ydTFPRjyVeTJwTWKSyAzxQv4O6/YB+j/ALrTo2yds7jjo7x+NHrpaoSxytj5GKo7IQQjc9xuePfo+/7q8uXS3s1kuFgTzFYop5PZOU7/AGgzL0ZsXlbeNslDNVmeGQoeV8lJB4P51qjaghtV5K9iJZYZFKujDkMD9a9ArsnbW3lv7z+S3rtavyySrjo2LIjOSSi8dyP379D3/dBmXehLk7MmLrzV6TSEwRTP5ui/QJ+/9796Ld0ubFGbgTw9JSQXwewcL1UxFCzlMnWx1QIbFmQRxh3CLyf0noaUvjinitvfKmBxeGz82QuMZo8o8HVVv+bEIh9vwR2T1zxxoeqWYLdaOzVmSaGRfJHQ8hhrY2vm7m3M9VzNBYms1iTGJVJXtSp5AI+idO5FnF0eKhhZEMa7FnHckavIDvod/KS/kunitwfKucxeZz02OtqIUxck3dVSY1LI59oCT7HXPJOivL4+zispZxtwRixWkMcng4deR+EdHVrdWcubkz1nNZBYVs2fHzESlV6UKOASfoDWPanhq15LFmVIoY1LO7ngKP0nRbgwiC8U83Ihk3ZShHdko8ou2p38r//Z" alt="" style="width:24px;height:24px;" /></div>
      <div class="setup-title">EGNYTE YODA — Setup</div>
    </div>
    <div class="setup-sub">
      Enter the base URL for the internal API. All data endpoints will be derived from this URL.<br><br>
      You only need to do this once — your preference is saved locally in this browser.
    </div>
    <div class="setup-field">
      <label class="setup-label" for="setup-url-input">API Base URL</label>
      <input class="setup-input" id="setup-url-input" type="url"
        placeholder="https://your-internal-api.example.com" autocomplete="off" spellcheck="false" />
      <div class="setup-hint">Example: https://domaininfo.your-company-internal.com</div>
    </div>
    <div class="setup-error" id="setup-error">
      <span>⚠</span><span id="setup-error-msg">Please enter a valid URL.</span>
    </div>
    <div class="setup-actions">
      <button class="setup-skip" id="setup-skip">Use demo data only</button>
      <button class="btn btn-primary" id="setup-save">Save & Continue →</button>
    </div>
  </div>
</div>
<script src="popup.js"></script>
</body>
</html>
